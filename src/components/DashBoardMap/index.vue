<template>
  <div>
    <div class="block">
      <span class="demonstration">地域筛选</span>
      <el-cascader
        :options="selectorOptions"
        v-model="selectedArea"
        @change="areaFilter">
      </el-cascader>
      <div class="dashboard-map-container">
        <!--<h2>-->
        <!--中国地图-->
        <!--</h2>-->
      </div>
    </div>

  </div>

</template>

<script>
  // http://efe.baidu.com/blog/echarts-map-tutorial/
  // http://gallery.echartsjs.com/editor.html?c=xBJDR584vG
  import echarts from 'echarts';
  // 一定要引入才能正常显示
  import 'echarts/map/js/world';
  import {
    getDeviceAmount, getCityOptions, getGatewayByWorkshop,
    getFactoryOptions, getWorkshopOptions, getMapInfo,
  } from "../../api/api";

  export default {
    name: "DashBoardMap",
    data() {
      return {
        chart: null,
        option: {
          backgroundColor: '#404a59',  		// 图表背景色
          tooltip: {
            trigger: 'item',
            formatter: function (data)//对提示框的数据自定义
            {
              return data.seriesName + '<br/>' + data.name + '：' + (data.value[2]); //将小数转化为百分数显示

            }
          }, // 鼠标移到图里面的浮动提示框
          geo: { // 这个是重点配置区
            map: 'world', // 表示世界地图
            roam: true,
            itemStyle: {					// 定义样式
              normal: {					// 普通状态下的样式
                areaColor: '#323c48',
                borderColor: '#111'
              },
              emphasis: {					// 高亮状态下的样式
                areaColor: '#483636'
              }
            }
          },
          series: [
            {
              name: '设备分布', // series名称
              type: 'scatter', // series图表类型
              coordinateSystem: 'geo', // series坐标系类型
              data: [
                {name: '上海', value: []}
              ],
            }
          ]
        },
        mapInfo: [],
        selectorOptions: [],
        selectedArea: []
      };
    },
    async mounted() {
      this.setMapInfo();
      this.chinaConfigure();
      this.getCascaderOptions();
    },
    methods: {
      chinaConfigure() {
        let myChart = echarts.init(document.getElementsByClassName('dashboard-map-container')[0]); //这里是为了获得容器所在位置
        window.onresize = myChart.resize;
        myChart.setOption(this.option);
        console.log(this.option);
      },
      areaFilter(value) {
        console.log(value);
      },
      async setMapInfo() {
        const amount = (await getMapInfo()).data.d;
        this.option.series = [
          {
            name: '设备分布', // series名称
            type: 'scatter', // series图表类型
            coordinateSystem: 'geo', // series坐标系类型
            data: amount,
          }
        ];
        this.chinaConfigure();
      },
      async getCascaderOptions() {
        this.selectorOptions = (await getCityOptions()).data.d;
      }
    }
  }
</script>

<style lang="scss" scoped>
  @import "../../assets/scss/variaties.scss";

  .block {
    margin: 10px;
  }

  .dashboard-map-container {
    height: $dashboard-block-height;
  }

  .search-container {
    margin: 1% 1%;
    text-align: left;
  }
</style>
